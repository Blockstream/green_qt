dist: bionic
os: linux
language: minimal
cache:
  ccache: true
  directories:
    - $TRAVIS_BUILD_DIR/build-linux-gcc

before_install:
    - set -o errexit; sudo ./tools/bionic_deps.sh
script:
    - set -o errexit; source ./tools/buildenvs.sh
    - ./tools/travisdotter.sh
    - mkdir -p ${BUILDDIR}
    - ./tools/buildqt.sh || (cat ${QTBUILD}/build.log && false)
    - ./tools/buildgdk.sh || (cat ${GDKBUILD}/build.log && false)
    - ${QT_PATH}/bin/qmake ../green.pro CONFIG+=release CONFIG+=x86_64 CONFIG+=qml_release CONFIG+=static QMAKE_CXXFLAGS_RELEASE+=-flto QMAKE_LDFLAGS_RELEASE+=-flto
    - make -j${NUM_JOBS}
    - python ../tools/symbol-check.py < ${BUILDROOT}/Green
