package-shared:build:
  tags:
    - garelease
  stage: package
  variables:
    GIT_STRATEGY: none
  artifacts:
    name: "$CI_PROJECT_NAME-$CI_JOB_NAME-$CI_COMMIT_SHORT_SHA"
    expire_in: 1 week
    paths:
    - $CI_PROJECT_DIR/dist
    when: on_success
  script:
    - cd $CI_PROJECT_DIR
    - rm -fr dist
    - mkdir dist
    - mv BlockstreamSetup.exe dist/BlockstreamSetup-x86_64.exe
    - mv macos-arm64-shared/Blockstream.dmg dist/Blockstream-arm64.dmg
    - mv macos-x86_64-shared/Blockstream.dmg dist/Blockstream-x86_64.dmg
    - mv macos-universal-shared/Blockstream.dmg dist/Blockstream-universal.dmg
    - chmod +x linux-x86_64-shared/Blockstream-x86_64.AppImage
    - mv linux-x86_64-shared/Blockstream-x86_64.AppImage dist
    - cd dist
    - /opt/process_release
    - cat SHA256SUMS.asc
  needs:
    - linux-x86_64-shared:build-appimage
    - macos-arm64-shared:staple
    - macos-x86_64-shared:staple
    - macos-universal-shared:staple
    - windows-x86_64-shared:sign-installer
