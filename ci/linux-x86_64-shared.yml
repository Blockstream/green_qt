linux-x86_64-shared:build-image:
  extends: .docker_build
  variables:
    IMAGE: $CI_REGISTRY_IMAGE/linux-x86_64-shared
    DOCKER_FILE: ci/linux-x86_64-shared/Dockerfile
    DOCKER_BUILD_ARGS: --build-arg QT_INSTALLER_JWT_TOKEN=${QT_INSTALLER_JWT_TOKEN}

.linux-x86_64-shared:
  image: $CI_REGISTRY_IMAGE/linux-x86_64-shared@sha256:38b2f4bf094d75e5ccd5d5c8e3389c56b203f221b8611711b60bb2f2be8a84da
  extends:
    - .build
  tags:
    - cloud

linux-x86_64-shared:build-appimage:
  extends:
    - .linux-x86_64-shared
  before_script:
    - export PATH="/qt/6.8.3/gcc_64/bin:$PREFIX/bin/:$PATH"
    - export CMAKE_PREFIX_PATH="$PREFIX:$CMAKE_PREFIX_PATH"
  after_script:
    - mv build/blockstream .
    - tools/appimage.sh --plugin-qt $CI_PROJECT_DIR
    - mkdir linux-x86_64-shared
    - mv Blockstream-x86_64.AppImage linux-x86_64-shared/
  artifacts:
    name: "$CI_PROJECT_NAME-$CI_JOB_NAME-$CI_COMMIT_SHORT_SHA"
    expire_in: 1 week
    paths:
      - linux-x86_64-shared/Blockstream-x86_64.AppImage
